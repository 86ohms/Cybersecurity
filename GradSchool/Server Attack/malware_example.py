import socket
import time
import os
import json

HOST = "localhost"  # The server's hostname or IP address
PORT = 65432  # The port used by the server
current_time = time.time()

def delete_client():
    try:
        client_path = os.path.abspath(__file__)
        print("\nDeleting myself... :-(\n")
        print("Put 'os.remove(client_path)' here.\n")
        time.sleep(1)
        # os.remove(client_path) # Placeholder for deleting this script
        print(f"Deleted {client_path} successfully!\n")
    except Exception as e:
        print(f"Error deleting the client: {e} :-(\n")

def attack_me():
    lyrics = [
    "We're no strangers to love",
    "You know the rules and so do I (do I)",
    "A full commitment's what I'm thinking of",
    "You wouldn't get this from any other guy",
    "I just wanna tell you how I'm feeling",
    "Gotta make you understand",
    "Never gonna give you up",
    "Never gonna let you down",
    "Never gonna run around and desert you",
    "Never gonna make you cry",
    "Never gonna say goodbye",
    "Never gonna tell a lie and encrypt you\n"
    ]
    for line in lyrics:
        print(line)
        time.sleep(0.5)
    time.sleep(1)
    print("...Starting Ransomware.py attack...\n")
    time.sleep(2)
    print("Just kidding! This is just an example.\n")

def main():
    while True:
        try:
            with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as client_socket:
                client_socket.connect((HOST, PORT))
                print("Connected to the malware host. Shh...")
                registration_info = {
                    'hostname': socket.gethostname(),
                    'timestamp': int(time.time())
                }
                client_socket.send(json.dumps(registration_info).encode())

                while True:
                    command = client_socket.recv(1024).decode()
                    if command:
                        print(f"Received command: {command.upper()}")
                        if command.upper() == 'DELETE':
                            print("Deleting malware.py file...")
                            delete_client()
                            break
                        elif command.upper() == 'ATTACK':
                            attack_me()
                            break
                        elif command.upper() == 'EXIT':
                            print("You asked me to leave. Ta ta for now...")
                            break
                        elif command.upper() == 'DISCONNECT' or socket.error:
                            print("Server connection lost. Ta ta for now...")
                            break
                        else:
                            print(f"I'm sorry Dave, I cannot do a '{command}' command.")
                break 

        except socket.error as e:
            print("Could not connect to secret server. Retrying in 3 seconds...")
            time.sleep(3)

if __name__ == "__main__":
    main()